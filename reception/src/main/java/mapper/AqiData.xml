<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="aqiData">
	<resultMap type="bean.CityAqi" id="cityAqi">
		<result property="cityName" column="city_name" />
		<result property="time" column="time" />
		<result property="aqiData" column="aqi_data" />
		<result property="aqiGrade" column="aqi_grade" />
	</resultMap>
	
	<select id="selectCityCurrentAqi" resultMap="cityAqi">
		SELECT 
		city_name, time, aqi_data, aqi_grade
		FROM
		city_aqi
		WHERE
		city_name=#{cityName} AND time in (select max(time) from city_aqi where city_name=#{cityName})
	</select>
	
	<select id="selectAllCityAvgAqi" resultMap="cityAqi">
		SELECT 
		avg(aqi_data) AS aqi_data, #{beginTime} AS time , city_name
		FROM
		city_aqi
		WHERE
		time &gt;= #{beginTime} AND time &lt; #{endTime}
		GROUP BY 
		city_name
	</select>
	
	<insert id="insertUserAction" parameterType="bean.UserAction">
		INSERT INTO
		userAction(user_id,device_id,command,data,time)
		VALUES(#{userID},#{deviceID},#{command},#{data},#{time})
	</insert>
</mapper>